<!doctype html>
<html lang="hr">
<head>
    <meta charset="utf-8" />
    <title>MedSys – Pretraga pacijenata</title>
    <link rel="stylesheet" href="/css/site.css">
    <script defer src="/js/api.js"></script>
    <script defer>
        document.addEventListener('DOMContentLoaded', () => {
            const rows = qsel('#rows'), msg = qsel('#msg');

            async function search() {
                const last = qsel('#qLast').value.trim();
                const oib = qsel('#qOib').value.trim();
                const qs = new URLSearchParams();
                if (last) qs.set('lastName', last);
                if (oib) qs.set('oib', oib);
                try {
                    const data = await apiGet('/api/patients' + (qs.toString() ? ('?' + qs.toString()) : ''));
                    msg.textContent = `Pronađeno: ${data.length}`;
                    rows.innerHTML = data.map(p =>
                        `<tr>
                  <td>${esc(p.firstName)}</td>
                  <td>${esc(p.lastName)}</td>
                  <td>${esc(p.oib)}</td>
                  <td><a class="btn" href="/patient.html?id=${p.id}">Detalji</a></td>
                </tr>`).join('');
                } catch (err) { toast(err?.message || 'Greška pri dohvaćanju.'); }
            }

            qsel('#btnSearch').addEventListener('click', search);
            // automatski prvi load
            search();
        });
    </script>
</head>
<body>
    <header class="nav">
        <h1>MedSys</h1>
        <nav>
            <a class="btn" href="/index.html">Pacijenti</a>
            <a class="btn" href="/api/patients/export.csv" target="_blank" rel="noopener">Izvoz CSV</a>
            <a class="btn ghost" href="/swagger" target="_blank" rel="noopener">Swagger</a>
        </nav>
    </header>

    <main class="card">
        <h2>Pretraga</h2>
        <div class="row">
            <label>Prezime<br><input id="qLast"></label>
            <label>OIB<br><input id="qOib" maxlength="11"></label>
            <div style="align-self:end"><button id="btnSearch" class="btn">Traži</button></div>
        </div>
        <div><small id="msg"></small></div>
        <table class="table">
            <thead><tr><th>Ime</th><th>Prezime</th><th>OIB</th><th></th></tr></thead>
            <tbody id="rows"></tbody>
        </table>
    </main>
</body>
</html>
